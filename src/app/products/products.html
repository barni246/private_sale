<header>
    <button style="position: fixed; right: 8px;" type="button" routerLink="/">Welcome</button>
    <h1>Lagerauflösung</h1>
</header>


<main>

    @for (product of products; track $index) {
    <div class="product-wrapper" [class.fullscreen]="isFullscreenIndex === $index">
        <button class="nav left" (click)="prev(product)">❮</button>

        <img [src]="product.images[product.currentIndex]" [alt]="product.title" />

        <button class="nav right" (click)="next(product)">❯</button>

        <div class="counter">
            {{ product.currentIndex + 1 }} / {{ product.images.length }}
        </div>

        <button class="fullscreen-btn" (click)="toggleFullscreen($index)">
            {{ isFullscreenIndex === $index ? 'Exit' : 'Fullscreen' }}
        </button>

        @if (isFullscreenIndex != $index) {
             <button  class="contact" (click)="scrollToForm()">Kontakt</button>
        }

        


        <div class="title">{{ product.title }}</div>
    </div>
    }

<div style="width: 100%; margin-top: 150px; margin-bottom: 80px;  height: 100%;">


  <form #contactForm [formGroup]="form" (ngSubmit)="sendMessage()" class="contact-form">

    <!-- NAME -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Name</mat-label>
      <input matInput type="text" formControlName="name">

      @if (name?.touched && name?.invalid) {
      <mat-error>Name ist erforderlich (min. 2 Zeichen).</mat-error>
      }
    </mat-form-field>

    <!-- EMAIL -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Email</mat-label>
      <input matInput type="email" formControlName="email" style="position: relative;">
      <div style="position: absolute; bottom: -24px; left: 0; font-size: 11px; display: flex;">




        @if (email?.touched && email?.errors) {
        @if (email?.errors?.['required']) {
        <mat-error>Email ist erforderlich.</mat-error>
        }

        @if (email?.errors?.['email']) {
        <mat-error>Keine gültige E-Mail-Adresse.</mat-error>
        }

        @if (email?.errors?.['pattern']) {
        <mat-error>Bitte ein korrektes E-Mail-Format verwenden.</mat-error>
        }
        }
      </div>

    </mat-form-field>

    <!-- MESSAGE -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Nachricht</mat-label>
      <textarea matInput rows="5" formControlName="message"></textarea>

      @if (message?.touched && message?.invalid) {
      <mat-error>Nachricht ist erforderlich (min. 10 Zeichen).</mat-error>
      }
    </mat-form-field>

    <!-- RATE LIMIT -->
    @if (rateLimitError) {
    <div class="rate-error">{{ rateLimitError }}</div>
    }

    <button mat-raised-button color="primary" [disabled]="form.invalid">
      Senden
    </button>

  </form>




</div>


</main>




<!-- <div class="product-wrapper" *ngFor="let product of products; let i = index"
    [class.fullscreen]="isFullscreenIndex === i">
    <button class="nav left" (click)="prev(product)">❮</button>

    <img [src]="product.images[product.currentIndex]" [alt]="product.title" />

    <button class="nav right" (click)="next(product)">❯</button>

    <div class="counter">
        {{ product.currentIndex + 1 }} / {{ product.images.length }}
    </div>

    <button class="fullscreen-btn" (click)="toggleFullscreen(i)">
        {{ isFullscreenIndex === i ? 'Exit' : 'Fullscreen' }}
    </button>

    <div class="title">{{ product.title }}</div>
</div> -->